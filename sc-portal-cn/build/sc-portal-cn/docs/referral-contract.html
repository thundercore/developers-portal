<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>用 referral solidity 获取更多用户 · Developer Portal</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;当你的用户在他们朋友面前对你的产品赞不绝口时，没有什么比推荐行销更棒的行销策略了！&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="用 referral solidity 获取更多用户 · Developer Portal"/><meta property="og:type" content="website"/><meta property="og:url" content="https://www.thundercore.com/"/><meta property="og:description" content="&lt;p&gt;当你的用户在他们朋友面前对你的产品赞不绝口时，没有什么比推荐行销更棒的行销策略了！&lt;/p&gt;
"/><meta property="og:image" content="https://www.thundercore.com/img/thundercore_icon.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://www.thundercore.com/img/thundercore_icon.svg"/><link rel="shortcut icon" href="/img/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-134150236-9', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/TT_dev_logo.png" alt="Developer Portal"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://thundercore.com" target="_self">ThunderCore.com</a></li><li class="siteNavGroupActive"><a href="/docs/deploy-your-own-game" target="_self">文档</a></li><li class="siteNavGroupActive"><a href="/docs/faqs/general" target="_self">常问问题</a></li><li class=""><a href="https://developer.thundercore.com" target="_self">🌐English</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>工具</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">在 ThunderCore 上开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/deploy-your-own-game">快速部署你的游戏</a></li><li class="navListItem"><a class="navItem" href="/docs/migrate-to-thunder">从以太坊中迁移</a></li><li class="navListItem"><a class="navItem" href="/docs/develop-with-truffle">以 Truffle 开发</a></li><li class="navListItem"><a class="navItem" href="/docs/erc20-smart-contract">部署你自己的 ERC-20</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开始入门</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/get-wallet">获得钱包</a></li><li class="navListItem"><a class="navItem" href="/docs/get-tokens">获得代币</a></li><li class="navListItem"><a class="navItem" href="/docs/ledger-nano-s">Ledger Nano S</a></li><li class="navListItem"><a class="navItem" href="/docs/iOS-install">苹果安装档下载教程</a></li><li class="navListItem"><a class="navItem" href="/docs/Android-install">安卓安装档下载教程</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">工具</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/random-number-generator">随机数生成器</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/referral-contract">用 referral solidity 获取更多用户</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">常见问题</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/faqs/general">总览</a></li><li class="navListItem"><a class="navItem" href="/docs/faqs/technical">技术类问题</a></li><li class="navListItem"><a class="navItem" href="/docs/faqs/pre-release-mainnet">预发主网</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">用 referral solidity 获取更多用户</h1></header><article><div><span><p>当你的用户在他们朋友面前对你的产品赞不绝口时，没有什么比推荐行销更棒的行销策略了！
许多知名的 DApps 像是 <a href="https://exitscam.me/">Fomo3d</a>, <a href="https://www.mycryptoheroes.net">My Crypto Heroes</a>, <a href="https://www.hypersnakes.io/e/e/d/index.html">HyperSnake</a>... 都有推荐分润系统。</p>
<p>因此，我们开发了一个智能合约推荐库, <a href="https://github.com/thundercore/referral-solidity">Referral Solidity</a>, 来帮助 DApps 开发人员快速打造自己的推荐分潠系统。我们将解释如何使用我们的库，并展示整合到另一篇翻硬币 DApps 教程的成果。你可以在这里<a href="https://jiang-yifan.github.io">试玩</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="referral-solidity-库"></a><a href="#referral-solidity-库" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Referral Solidity 库</h2>
<p>我们打造了一个多层次推荐库 referral solidty 在 <a href="https://github.com/thundercore/referral-solidity/">https://github.com/thundercore/referral-solidity/</a>. 有了这个库，你可以立马有以下功能:</p>
<ul>
<li>多层次 (目前最大为3层) 原生代币 (ETH, TT...) 系统分润系统</li>
<li>根据推荐人数计算推荐奖金</li>
<li>当下线加入游玩立刻驱动付推荐金机制</li>
<li>只有活跃用户能领推荐奖金</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="如何使用"></a><a href="#如何使用" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何使用</h3>
<p>首先安装我们的库：</p>
<pre><code class="hljs css language-bash">npm install @thundercore/referral-solidity
</code></pre>
<p>透过导入、初始化推荐合约、 <code>addReferrer</code> 函式绑定上线跟 <code>payReferral</code>触发函式推荐金支付等四步，来整合 referral solidity 到你的 DApps。</p>
<pre><code class="hljs css language-solidity">pragma solidity ^<span class="hljs-number">0.5</span>.<span class="hljs-number">0</span>;
import '@thundercore/referral-solidity/contracts/<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Referral</span>.</span></span>sol';

contracts YourGame is Referral {
  <span class="hljs-comment">// Referral(decimals, referralBonus, secondsUntilInactive, onlyRewardActiveReferrers, levelRate, refereeBonusRateMap)</span>
  constructor<span class="hljs-literal">()</span> Referral (<span class="hljs-number">10000</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1</span> days, <span class="hljs-literal">true</span>, <span class="hljs-literal">[<span class="hljs-number">6000</span>, <span class="hljs-number">3000</span>, <span class="hljs-number">1000</span>]</span>, <span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>]</span>) public {
  }

  <span class="hljs-comment">// bind uplineAddr as msg.sender's referrer</span>
  <span class="hljs-keyword">function</span> add<span class="hljs-constructor">Upline(<span class="hljs-params">address</span> <span class="hljs-params">payable</span> <span class="hljs-params">uplineAddr</span>)</span> public {
    add<span class="hljs-constructor">Referrer(<span class="hljs-params">upline</span>)</span>;
  }

  <span class="hljs-comment">// trigger pay referral in your business logic</span>
  <span class="hljs-keyword">function</span> play<span class="hljs-literal">()</span> public payable {
    pay<span class="hljs-constructor">Referral(<span class="hljs-params">msg</span>.<span class="hljs-params">value</span>)</span>;
  }
}
</code></pre>
<p>在 <code>constructor() Referral (10000, 500, 1 days, true, [6000, 3000, 1000], [1, 10000])</code> 这行, 你可能觉得搞不清这里面参数的意思，我们将一一解释，首先这些建构子参数对应到的以下变数:</p>
<pre><code class="hljs css language-solidity"><span class="hljs-constructor">Referral(<span class="hljs-params">decimals</span>, <span class="hljs-params">referralBonus</span>, <span class="hljs-params">secondsUntilInactive</span>, <span class="hljs-params">onlyRewardActiveReferrers</span>, <span class="hljs-params">levelRate</span>, <span class="hljs-params">refereeBonusRateMap</span>)</span>
</code></pre>
<p>这里是所有参数的解释:</p>
<h5><a class="anchor" aria-hidden="true" id="decimals-uint"></a><a href="#decimals-uint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>decimals <code>&lt;uint&gt;</code></h5>
<p>所有推荐比率计算的基数，由于 Solidity 还没有支援浮点数，使用 decimals 作为所有比率计算的基底。
举例来说，如果 <code>decimals</code> 为 <code>10000</code> 而且 <code>referralBonus</code> 为 <code>500</code> 那代表总推荐奖金池比率为 <code>5%</code>。</p>
<h5><a class="anchor" aria-hidden="true" id="referralbonus-uint"></a><a href="#referralbonus-uint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>referralBonus <code>&lt;uint&gt;</code></h5>
<p>总推荐奖金池比率，计算时会跟 <code>decimals</code> 相除。举例来说， 如果你想要 <code>5%</code> 交易金额用于推荐奖金，你可以将其设为 <code>50</code> 对应 <code>decimals</code> 为 <code>1000</code>。</p>
<h5><a class="anchor" aria-hidden="true" id="secondsuntilinactive-uint"></a><a href="#secondsuntilinactive-uint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>secondsUntilInactive <code>&lt;uint&gt;</code></h5>
<p>多少秒没游玩用户为不活跃用户。举例来说 <code>one days</code>。</p>
<h5><a class="anchor" aria-hidden="true" id="onlyrewardactivereferrers-bool"></a><a href="#onlyrewardactivereferrers-bool" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>onlyRewardActiveReferrers <code>&lt;bool&gt;</code></h5>
<p>是否要启用只付费给活跃用户。</p>
<h5><a class="anchor" aria-hidden="true" id="levelrate-uint"></a><a href="#levelrate-uint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>levelRate <code>&lt;uint[]&gt;</code></h5>
<p>每层奖励比率，计算时会跟 <code>decimals</code> 相除。目前最大层数为 3。举例来说，设置 <code>levelRate</code> 为 <code>[6000, 3000, 1000]</code> ，对应 <code>decimals</code> 为 <code>10000</code> ，代表以下状况:</p>
<table>
<thead>
<tr><th></th><th>1级推荐</th><th>2级推荐</th><th>3级推荐</th></tr>
</thead>
<tbody>
<tr><td>比率</td><td>60%</td><td>30%</td><td>10%</td></tr>
</tbody>
</table>
<h5><a class="anchor" aria-hidden="true" id="refereebonusratemap-uint"></a><a href="#refereebonusratemap-uint" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>refereeBonusRateMap <code>&lt;uint[]&gt;</code></h5>
<p>推荐人数奖励比率，计算时会跟 <code>decimals</code> 相除。目前最大层数为 3，人数奖励对应表传参格式如 [ <code>&lt;最低人数&gt;</code>, <code>&lt;比率&gt;</code>, ... ]。 举例来说，你应该传递 <code>[1, 2500, 5, 5000, 10, 10000]</code> 对应 <code>decimals</code> 为 <code>10000</code> 代表以下状况:</p>
<table>
<thead>
<tr><th></th><th>1 - 4</th><th>5 - 9</th><th>10+</th></tr>
</thead>
<tbody>
<tr><td>比率</td><td>25%</td><td>50%</td><td>100%</td></tr>
</tbody>
</table>
<p>让我们看以下例子来大家有个更清楚的理解。</p>
<h2><a class="anchor" aria-hidden="true" id="示例-整合到赌硬币-dapp"></a><a href="#示例-整合到赌硬币-dapp" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例 - 整合到赌硬币 DApp</h2>
<p><img src="/docs/assets/img/referral/screenshot.png" alt="game-image"></p>
<p>在这篇<a href="/docs/deploy-your-own-game">教程</a>，你可以布署跟打造自己的翻硬币游戏。现在让我们加入推荐系统到游戏里!
让我们设置以下规则：</p>
<ul>
<li>3% 的赌金会用于推荐</li>
<li>在不同的推荐阶层，用户可以得到 3% 中的 60%, 30%, 10% 奖金</li>
<li>如果用户只推荐 5 人不到，只能得到 50% 应得的推荐奖金；只推荐 25 人不到，只能得到 75% 应得的推荐奖金；超过 25 人以上才能得到所有应得奖金。</li>
<li>用户必须为活跃用户才能领奖金，活跃过期时间为一天，如果有下线玩游戏，但用户为非活跃用户，也不能领到奖金。</li>
</ul>
<p>因此，假设以下状况：
推荐序列为 A ← B ← C ← D. A 有推荐人 25 人, B 有推荐人 6 人 而 C 有推荐人 1 人。当 D 赌 1 TT 时， 3% 会用来作为推荐奖池也就是 0.03 TT。那每一级上线可以得到:</p>
<ul>
<li>A: 1 * 0.03 * 0.1 * 1 = 0.003</li>
<li>B: 1 * 0.03 * 0.3 * 0.75 = 0.00675</li>
<li>C: 1 * 0.03 * 0.6 * 0.5 = 0.009</li>
</ul>
<p>此时建构子参数值如下:</p>
<table>
<thead>
<tr><th></th><th>decimals</th><th>referralBonus</th><th>secondsUntilInactive</th><th>onlyRewardActiveReferrers</th><th>levelRate</th><th>refereeBonusRateMap</th></tr>
</thead>
<tbody>
<tr><td>value</td><td>1000</td><td>30</td><td>86400</td><td>true</td><td>[600, 200, 100]</td><td>[1, 500, 5, 750, 25, 1000]</td></tr>
</tbody>
</table>
<p>那接下来，我们就实际整合推荐合约到赌硬币作为示例：</p>
<h3><a class="anchor" aria-hidden="true" id="合约"></a><a href="#合约" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>合约</h3>
<p>首先导入并将参数传递给我们的推荐合约:</p>
<pre><code class="hljs css language-solidity">pragma solidity <span class="hljs-number">0.5</span>.<span class="hljs-number">0</span>;

import <span class="hljs-string">'@thundercore/referral-solidity/contracts/Referral.sol'</span>;
...

contract DoubleOrNothing is Ownable, Referral {
  ...
  constructor(
      uint <span class="hljs-variable">_decimals</span>,
      uint <span class="hljs-variable">_referralBonus</span>,
      uint <span class="hljs-variable">_secondsUntilInactive</span>,
      bool <span class="hljs-variable">_onlyRewardActiveReferrers</span>,
      uint256[] memory <span class="hljs-variable">_levelRate</span>,
      uint256[] memory <span class="hljs-variable">_refereeBonusRateMap</span>
  ) Referral(
      <span class="hljs-variable">_decimals</span>,
      <span class="hljs-variable">_referralBonus</span>,
      <span class="hljs-variable">_secondsUntilInactive</span>,
      <span class="hljs-variable">_onlyRewardActiveReferrers</span>,
      <span class="hljs-variable">_levelRate</span>,
      <span class="hljs-variable">_refereeBonusRateMap</span>
  ) public {}
  ...
</code></pre>
<p>然后，添加多載 <code>bet</code> 函式，如果是调用带有地址的 bet 函式，下注第一次时绑定推荐上线。</p>
<p>Then, add overload bet function to bind referral upline when bet with the address.</p>
<pre><code class="hljs css language-solidity">  <span class="hljs-keyword">function</span> bet(address payable _referrer) payable external {
    <span class="hljs-keyword">if</span>(!has<span class="hljs-constructor">Referrer(<span class="hljs-params">msg</span>.<span class="hljs-params">sender</span>)</span>) {
      add<span class="hljs-constructor">Referrer(<span class="hljs-params">_referrer</span>)</span>;
    }
    bet<span class="hljs-literal">()</span>;
  }
</code></pre>
<p>下一步，添加 ``payReferral<code>到</code>bet` 函式里。</p>
<pre><code class="hljs">  <span class="hljs-keyword">function</span> bet() payable <span class="hljs-built_in">public</span> {
    // msg.<span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> added <span class="hljs-keyword">to</span> the balance <span class="hljs-keyword">to</span> <span class="hljs-keyword">begin</span> <span class="hljs-keyword">with</span> so you need <span class="hljs-keyword">to</span> <span class="hljs-type">double</span> it
    require(msg.<span class="hljs-keyword">value</span> * <span class="hljs-number">2</span> &lt;= address(this).balance, <span class="hljs-string">'Balance too low!'</span>);
    uint256 winnings = <span class="hljs-number">0</span>;

    // <span class="hljs-keyword">DO</span> <span class="hljs-keyword">NOT</span> USE THIS <span class="hljs-keyword">IN</span> PRODUCTION, IT <span class="hljs-keyword">IS</span> INSECURE
    <span class="hljs-keyword">if</span>(uint256(blockhash(block.number <span class="hljs-number">-1</span>)) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
      // <span class="hljs-number">3</span>% <span class="hljs-keyword">is</span> deducted <span class="hljs-keyword">to</span> cover the referral bonus
      winnings = msg.<span class="hljs-keyword">value</span> * <span class="hljs-number">197</span>/<span class="hljs-number">100</span>;
      address(msg.sender).transfer(winnings);
    }
    payReferral(msg.<span class="hljs-keyword">value</span>);
    emit BetSettled(msg.sender, winnings);
  }
</code></pre>
<p>最后，为了布署带有推荐的赌硬币游戏，我们需要在 migration 传递参数。</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// migrations/1_initial_migration.js</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">deployer</span>) </span>{
  deployer.deploy(Migrations);
  deployer.deploy(
    Double,
    <span class="hljs-number">1000</span>,
    <span class="hljs-number">30</span>,
    <span class="hljs-number">86400</span>,
    <span class="hljs-literal">true</span>,
    [<span class="hljs-number">600</span>, <span class="hljs-number">200</span>, <span class="hljs-number">100</span>],
    [<span class="hljs-number">1</span>, <span class="hljs-number">500</span>, <span class="hljs-number">5</span>, <span class="hljs-number">750</span>, <span class="hljs-number">25</span>, <span class="hljs-number">1000</span>]
  );
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="前端"></a><a href="#前端" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端</h3>
<p>现在，您可以从合同中的公开变数 <code>accounts</code> 获取用户推荐数据，包括用户的总推荐人数和总推荐奖金。</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">this</span>.props.contract.accounts(<span class="hljs-keyword">this</span>.props.address).then(<span class="hljs-function">(<span class="hljs-params">info: any</span>) =&gt;</span> {
  <span class="hljs-keyword">this</span>.setState({
    <span class="hljs-attr">accountInfo</span>: {
      <span class="hljs-attr">reward</span>: info.reward.toString(),
      <span class="hljs-attr">referredCount</span>: info.referredCount.toString()
    }
  });
});
</code></pre>
<p>然后，你可以从网址解析出推荐人地址，像是 <code>https://jiang-yifan.github.io?referrer=0x26b067f40696c97a058658949ec011ed6a84afe3</code>。接下来，透过 <code>contract.bet(address)</code> 来触发合约绑定上线，以及 <code>contract.bet()</code> 来触发一般赌注，每次赌注都会自动转帐推荐奖金到上线。
更多细节，你可以参考<a href="https://github.com/jiang-yifan/jiang-yifan.github.io/blob/master/frontend/src/containers/GameContainer/GameContainer.tsx">源代码</a>。</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/random-number-generator"><span class="arrow-prev">← </span><span>随机数生成器</span></a><a class="docs-next button" href="/docs/yell"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#referral-solidity-库">Referral Solidity 库</a><ul class="toc-headings"><li><a href="#如何使用">如何使用</a></li></ul></li><li><a href="#示例-整合到赌硬币-dapp">示例 - 整合到赌硬币 DApp</a><ul class="toc-headings"><li><a href="#合约">合约</a></li><li><a href="#前端">前端</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="content"><a class="thunder-icon" href="http://thundercore.com"><img src="/img/thundercore_icon_white.svg" alt="Developer Portal" width="66" height="58"/></a><div class="site-links"><div class="title">资源</div><a href="/docs/faqs/general">常问问题</a><a href="https://discordapp.com/invite/5EbxXfw" target="_blank">在 Discord 上取得联系</a><a href="mailto:info@thundercore.com">电邮我们</a></div><div class="community"><div class="title">社区</div><div class="icons"><a href="https://twitter.com/ThunderProtocol" target="_blank" class="icon icon-twitter"><svg viewBox="0 0 52 52" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>icon_twitter_normal</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="dev_FAQ" transform="translate(-1136.000000, -2417.000000)"><g id="footer" transform="translate(0.000000, 2320.000000)"><g id="follow-us" transform="translate(1137.000000, 54.000000)"><g id="icon_twitter_normal" transform="translate(0.000000, 44.000000)"><circle id="Oval" stroke="none" cx="25" cy="25" r="25"></circle><g id="iconmonstr-twitter-1" transform="translate(8.000000, 12.000000)" fill="#FFFFFF" fill-rule="nonzero"><path d="M34,3.19642125 C32.7490833,3.73907916 31.4046667,4.10454266 29.9936667,4.2692781 C31.4344167,3.42622026 32.5408333,2.09034044 33.06075,0.498359311 C31.7135,1.27912223 30.2203333,1.84669811 28.6308333,2.15263536 C27.3600833,0.827830189 25.5453333,0 23.5393333,0 C19.03575,0 15.7264167,4.10592699 16.7435833,8.36828343 C10.948,8.08449549 5.80833333,5.37120591 2.36725,1.24728261 C0.53975,4.31080804 1.4195,8.3184475 4.52483333,10.3478774 C3.383,10.3118847 2.30633333,10.0059475 1.36708333,9.4951292 C1.29058333,12.6527892 3.60683333,15.6069524 6.9615,16.2645098 C5.97975,16.5247642 4.9045,16.5856747 3.81083333,16.3807937 C4.69766667,19.0885459 7.27316667,21.0584495 10.3275,21.1138228 C7.395,23.3605927 3.70033333,24.364233 0,23.9378589 C3.08691667,25.8717699 6.75466667,27 10.693,27 C23.6441667,27 30.96125,16.3115771 30.51925,6.72508203 C31.8820833,5.7629717 33.065,4.56275636 34,3.19642125 Z" id="Path"></path></g></g></g></g></g></g></svg></a><a href="https://medium.com/thunderofficial" target="_blank" class="icon icon-medium"><svg viewBox="0 0 52 52" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>icon_medium_normal</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="dev_FAQ" transform="translate(-1217.000000, -2418.000000)"><g id="footer" transform="translate(0.000000, 2320.000000)"><g id="follow-us" transform="translate(1137.000000, 54.000000)"><g id="icon_medium_normal" transform="translate(81.000000, 45.000000)"><circle id="Oval-Copy" stroke="none" fill="none" cx="25" cy="25" r="25"></circle><path d="M13.6760037,17.8959436 C13.7145189,17.524844 13.5694015,17.1580533 13.2852474,16.9082892 L10.3907563,13.5079365 L10.3907563,13 L19.3781513,13 L26.32493,27.8571428 L32.4323064,13 L41,13 L41,13.5079365 L38.5252101,15.8218695 C38.3118561,15.9804649 38.2060216,16.2411276 38.2502335,16.4991182 L38.2502335,33.5008819 C38.2060216,33.7588725 38.3118561,34.0195351 38.5252101,34.1781305 L40.9421102,36.4920635 L40.9421102,37 L28.7852475,37 L28.7852475,36.4920635 L31.2889824,34.1216932 C31.535014,33.8818342 31.535014,33.8112875 31.535014,33.4444445 L31.535014,19.70194 L24.5737628,36.9435626 L23.6330532,36.9435626 L15.528478,19.70194 L15.528478,31.2574955 C15.4609051,31.7433236 15.6263627,32.2324462 15.9771242,32.5837743 L19.2334267,36.4356262 L19.2334267,36.9435626 L10,36.9435626 L10,36.4356262 L13.2563025,32.5837743 C13.6045101,32.2318637 13.7603198,31.7394965 13.6760037,31.2574955 L13.6760037,17.8959436 Z" id="Shape" fill="#FFFFFF" fill-rule="nonzero"></path></g></g></g></g></g></svg></a><a href="https://www.reddit.com/r/thunder_official/" target="_blank" class="icon icon-reddit"><svg viewBox="0 0 52 52" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>icon_reddit_normal</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="dev_FAQ" transform="translate(-1298.000000, -2419.000000)"><g id="footer" transform="translate(0.000000, 2320.000000)"><g id="follow-us" transform="translate(1137.000000, 54.000000)"><g id="icon_reddit_normal" transform="translate(162.000000, 46.000000)"><circle id="Oval-Copy-2" stroke="none" fill="currentColor" cx="25" cy="25" r="25"></circle><g id="iconmonstr-reddit-1" transform="translate(8.000000, 10.000000)" fill="#FFFFFF" fill-rule="nonzero"><path d="M34,13.6906 C34,11.648 32.3113333,9.9876 30.2359167,9.9876 C29.223,9.9876 28.305,10.388 27.62925,11.032 C25.0650833,9.3646 21.5956667,8.3034 17.7536667,8.1676 L19.8545833,1.631 L25.5439167,2.9484 L25.5354167,3.0296 C25.5354167,4.6998 26.9166667,6.0578 28.61525,6.0578 C30.3124167,6.0578 31.69225,4.6998 31.69225,3.0296 C31.69225,1.3594 30.311,0 28.61525,0 C27.3119167,0 26.20125,0.8036 25.7521667,1.9306 L19.6194167,0.5096 C19.3516667,0.4452 19.0796667,0.5978 18.9960833,0.8582 L16.6529167,8.148 C12.6324167,8.1956 8.99016667,9.2652 6.31125,10.983 C5.63975,10.3698 4.74866667,9.9862 3.76266667,9.9862 C1.68725,9.9862 0,11.648 0,13.6906 C0,15.0486 0.755083333,16.226 1.86575,16.87 C1.79208333,17.2648 1.74391667,17.6638 1.74391667,18.0698 C1.74391667,23.5452 8.55525,28 16.9291667,28 C25.3030833,28 32.1158333,23.5452 32.1158333,18.0698 C32.1158333,17.6862 32.07475,17.3082 32.0095833,16.9358 C33.18825,16.31 34,15.099 34,13.6906 Z M9.59933333,16.233 C9.59933333,15.0178 10.6051667,14.028 11.8405,14.028 C13.0758333,14.028 14.08025,15.0178 14.08025,16.233 C14.08025,17.4482 13.0758333,18.4366 11.8405,18.4366 C10.6051667,18.4366 9.59933333,17.4482 9.59933333,16.233 L9.59933333,16.233 Z M22.43575,22.7696 C21.3066667,23.8798 19.5344167,24.4202 17.0184167,24.4202 L17,24.416 L16.9815833,24.4202 C14.4641667,24.4202 12.6919167,23.8798 11.56425,22.7696 C11.3588333,22.568 11.3588333,22.239 11.56425,22.0374 C11.7696667,21.8344 12.104,21.8344 12.3094167,22.0374 C13.23025,22.9432 14.7588333,23.3828 16.9815833,23.3828 L17,23.387 L17.0184167,23.3828 C19.2411667,23.3828 20.76975,22.9418 21.6905833,22.036 C21.896,21.833 22.2303333,21.8344 22.43575,22.036 C22.6411667,22.239 22.6411667,22.5666 22.43575,22.7696 Z M22.168,18.4366 C20.9326667,18.4366 19.92825,17.4482 19.92825,16.233 C19.92825,15.0178 20.9326667,14.028 22.168,14.028 C23.4033333,14.028 24.40775,15.0178 24.40775,16.233 C24.40775,17.4482 23.4033333,18.4366 22.168,18.4366 Z" id="Shape"></path></g></g></g></g></g></g></svg></a></div></div></div><div class="copyright">© Thunder Token Ltd. All Rights Reserved.</div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2ba8e14009945c804c7cd5beba150e08',
                indexName: 'thundercore_developers-cn',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>